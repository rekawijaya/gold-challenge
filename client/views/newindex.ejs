<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Kreatif Social Media</title>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            background-image: url('/ishan-seefromthesky-WVziwa_DDwI-unsplash.jpg');
            background-size: cover;
            background-position: center;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: rgb(107, 69, 161);
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        .profile {
            background-color: rgba(52, 58, 64, 0.7);
            color: #000000;
            padding: 25px;
            text-align: center;
            font-weight: 700;
            text-transform: capitalize;
        }
        .profile img {
            max-width: 150px;
            border: 5px solid #fff;
            border-radius: 50%;
        }
        .profile-info {
            background-color: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: left;
            margin-top: 20px;
        }
        .profile-info i {
            font-size: 24px;
            margin-right: 30px;
            margin-left: 30px;
            margin-top: 20px;
            color: rgb(107, 69, 161)
        }
        .post-form {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        .post-cards {
            background-color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .contain-post {
            margin-top: 1rem;
        }
        
        .post-form label,
        .post-form textarea,
        .post-form input {
            color: #000000;
        }
    </style>
</head>
<body>

<!-- Header -->
<div class="header">
    <h1 class="display-4">WANDERELY</h1>
</div>

<!-- Profile -->
<div class="container-fluid profile mt-4">
    <div class="row">
        <div class="col-md-6 mx-auto text-center">
            <img src="/cesar-rincon-XHVpWcr5grQ-unsplash.jpg" alt="Profile Picture" class="img-fluid">
            <div class="mt-3 profile-info">
                <i class='fas fa-user'></i><%=data[0].username%><br>
                <i class='fas fa-user-alt'></i><%=data[0].name%><br>
                <i class='fas fa-envelope'></i><%=data[0].email%><br>
                <i class='fas fa-map-marker-alt'></i><%=data[0].city%><br>
                <i class='fas fa-birthday-cake'></i><%=data[0].bday%><br>
                <i class='fas fa-venus-mars'></i><%=data[0].gender%><br>
                <a href="<%= base_url%>/logoff"><i class='fas fa-sign-out-alt'></i></a>Logout
            </div>
        </div>
    </div>
</div>

<!-- Post Form -->
<div class="container post-form mt-4" id="form-post">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <form>
                <div class="mb-3">
                    <label for="postDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="postDescription" name="postDescription" rows="3" placeholder="Share your thoughts..."></textarea>
                </div>
                <div class="mb-3">
                    <label for="postImage" class="form-label">Upload Photo</label>
                    <input type="file" class="form-control" id="file_posting" name="postImage">
                    <small class="form-text text-muted">Maximum file size: 5MB. Supported formats: JPG, PNG.</small>
                </div>
                <div class="mb-3">
                    <label for="postLocation" class="form-label">Location</label>
                    <input type="text" class="form-control" id="postLocation" name="postLocation" placeholder="Enter location">
                </div>
                <div class="mb-3">
                    <label for="postBudget" class="form-label">Budget</label>
                    <input type="number" class="form-control" id="postBudget" name="postBudget" placeholder="Enter budget">
                </div>
                <div class="mb-3">
                    <label for="postDate" class="form-label">Date</label>
                    <input type="date" class="form-control" id="postDate" name="postDate">
                </div>
                <button type="button" class="btn" style="background-color: rgb(107, 69, 161); color: #fff;" onclick="myUpload()">Post</button>
                <button type="button" class="btn" style="background-color: rgb(107, 69, 161); color: #fff;" onclick="myUpdate()">Update</button>
            </form>
        </div>
    </div>
</div>

<!-- Post Cards -->
<div class="container post-cards mt-4">
    <div class="row">
        <!-- <% if(posting.length > 0){ %> -->
            <% for (var i = 0; i < posting.length;  i++ ) { %>
        <div class="col-md-4 contain-post">
            <div class="card">
                <img src="<%=posting[i].file%>" class="card-img-top" alt="Post Image">
                <div class="card-body">
                    <p class="card-text"><%=posting[i].description%></p>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><%=posting[i].budget%></li>
                    <li class="list-group-item"><%=posting[i].location%></li>
                    <li class="list-group-item"><%=posting[i].date%></li>
                </ul>
                <div class="card-body react-button">
                    <div class="btn-container">
                        <input class="btn" style="position: absolute; margin-left: -1rem; opacity: 0;" type="button" id="id-like" value="<%=posting[i].id%>">
                        <i class="icon edit-icon" data-feather="heart"></i>
                        <input style="position: absolute; margin-left: -0.6rem; opacity: 1;" class="btn" type="button" id="id-update" value="<%=posting[i].id%>" onclick="toUpdate()">
                        <i class="icon edit-icon" data-feather="edit"></i>
                        <input style="position: absolute; margin-left: -0.5rem; opacity: 1;" class="btn" type="button" id="id-delete" value="<%=posting[i].id%>" onclick="deletePost()">
                        <i class="icon trash-icon" data-feather="trash"></i>
                    </div>
                </div>
            </div>
        </div>
        <% } %>
        <!-- <% } %> -->
    </div>
</div>
<script>
    feather.replace();
</script>g
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>

            function toUpdate(){
                window.location.href = '#form-post'
            }

    async function myUpload(){
    console.log("upload")
    let description = document.getElementById("postDescription").value
    let budget = document.getElementById("postBudget").value
    let date = document.getElementById("postDate").value
    let location = document.getElementById("postLocation").value
    let fileInput = document.getElementById("file_posting")
    let data = new FormData()
    data.append('description', description)
    data.append('budget', budget)
    data.append('file', fileInput.files[0])
    data.append('location', location)
    data.append('date', date)
    let config = {method: 'post', maxBodyLength: Infinity, url: 'http://localhost:3000/user/post/<%=user_id%>', headers: { }, data : data}
    let posting = await axios.request(config).then(response => response)
    if(posting.data.status === "success"){
        window.location.href = "<%=base_url%>"
    }
  }

    async function myUpdate() {
    console.log("update");

    let selectedPostId = document.getElementById("id-update").value
    let description = document.getElementById("postDescription").value
    let budget = document.getElementById("postBudget").value
    let date = document.getElementById("postDate").value;
    let location = document.getElementById("postLocation").value
    let fileInput = document.getElementById("file_posting")
    let data = new FormData()
    data.append('description', description)
    data.append('budget', budget)
    data.append('file', fileInput.files[0])
    data.append('location', location)
    data.append('date', date)
    console.log("data", data)

    let config = {
        method: 'put',
        maxBodyLength: Infinity,
        url: `http://localhost:3000/user/updateposting/${selectedPostId}`,
        headers: {},
        data: data
    }

    try {
        let posting = await axios.request(config)
        if (posting.data.status === "success") {
            window.location.href = "<%=base_url%>"
        }else{
            console.log(error);
        }
    } catch (error) {
        console.error("Error updating posting:", error);
    }
    }

    async function deletePost() {
    let idposting = document.getElementById('id-delete').value

    try {
        let config = {
        method: 'delete',
        maxBodyLength: Infinity,
        url: `http://localhost:3000/user/deleteposting/${idposting}`,
        headers: {},
        }
        let userConfirmed = confirm('Are you sure you want to delete this post?');
        if (userConfirmed) {
            let delPost = await axios.request(config)
            window.location.href = "<%=base_url%>"
        } else {
            console.log('delete gagall');
        }
    } catch (error) {
        console.error('Error deleting post:', error);
    }
    }
        </script>
    </body>
    </html>